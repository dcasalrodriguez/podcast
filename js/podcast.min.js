jQuery(function(){podcast.getPodcasts(),jQuery("#filter").on("keyup",function(){podcast.filterPodcasts(jQuery(this).val())}),jQuery(".podcast-container").on("click",function(){var a=jQuery(this).data("id"),b=jQuery(this).find(".podcast-title").html();jQuery.router.go("/podcast/"+a,b)});var a=localStorage.getItem("dev");util.isEmpty(a)||"1"!=a||(jQuery("link").each(function(){var a=jQuery(this).attr("href");util.isEmpty(a)||(a=a.replace(".min",""),jQuery(this).attr("href",a),console.log(a))}),jQuery("script").each(function(){var a=jQuery(this).attr("src");util.isEmpty(a)||(a=a.replace(".min",""),jQuery(this).attr("src",a))}))});var podcast=new function(){this.drawIndex=function(){jQuery("header").show(),jQuery(".filters").show(),jQuery("#podcasts-list").show(),jQuery("#podcasts-cdetail").hide(),jQuery("#podcasts-detail").hide()},this.drawDetail=function(a){var b=jQuery("#podcast-detail-template").html(),c=Handlebars.compile(b),d={entry:a};jQuery("#podcasts-detail").html(c(d)),util.loaderHide(),jQuery("header").hide(),jQuery("#podcasts-list").hide(),jQuery("#podcasts-cdetail").hide(),jQuery("#podcasts-detail").show()},this.drawResults=function(a,b,c,d,e){d=d||null,e=e||null;var f=jQuery(b).html(),b=Handlebars.compile(f),g={entries:a,id:e};if(jQuery(c).html(b(g)),!util.isEmpty(d)){var h=jQuery("section:visible");h.hide("slide",{direction:"left"},500,function(){jQuery(c).show("slide",{direction:"left"},500)})}util.isEmpty(e)?jQuery(".filters").show():(jQuery(".filters").hide(),jQuery(".btn-volver").attr("href",'javascript:jQuery.router.go("/podcast", "");')),util.loaderHide()},this.getEpisodeResults=function(a,b){util.loaderShow();var c="podcasts-episodes-"+b;jQuery.ajax({url:"php/proxyCross.php?url="+a,type:"xml",success:function(a){a=util.xmlToJson(a),podcast.setLocalData(a,c),podcast.drawResults(a.rss.channel,"#podcast-episodes-template","#podcasts-episodes",!0,b)},error:function(){console.error("Ha ocurrido un error en la obtención de episodios de Apple."),util.loaderHide()}})},this.getPodcastEpisodes=function(a){util.loaderShow();var b="#podcast-episodes-template",c="#podcasts-episodes",d="podcasts-episodes-"+a,e=podcast.isPodcastsLocal(d);if(e){var f=podcast.getPodcastsLocal(d);util.isEmpty(f)||util.isEmpty(f.rss)?(console.info("Datos en local con errores, se crea una nueva peticion."),podcast.removeLocalData(d),podcast.getPodcastEpisodes(a)):(podcast.drawResults(f.rss.channel,b,c,!0,a),util.loaderHide())}else jQuery.getJSON("https://itunes.apple.com/lookup?id="+a+"&callback=?",function(b){var c=b.results[0].feedUrl;podcast.getEpisodeResults(c,a)})},this.getPodcasts=function(){util.loaderShow();var a="#podcast-result-template",b="#podcasts-list",c="podcasts",d=podcast.isPodcastsLocal(c);if(d){var e=podcast.getPodcastsLocal(c);if(util.isEmpty(e.feed)||util.isEmpty(e.feed.entry))console.info("Datos en local con errores, se crea una nueva peticion."),podcast.removeLocalData(c),podcast.getPodcasts();else{podcast.drawResults(e.feed.entry,a,b);var f=e.feed.entry.length;jQuery("#contador-podcasts").html(f),util.loaderHide()}}else jQuery.ajax({type:"GET",url:"https://itunes.apple.com/us/rss/toppodcasts/limit=100/genre=1310/json",dataType:"json",async:!1,success:function(d){podcast.setLocalData(d,c),podcast.drawResults(d.feed.entry,a,b);var e=d.feed.entry.length;jQuery("#contador-podcasts").html(e),util.loaderHide()},error:function(){console.error("Ha ocurrido un error en la obtención de podcasts de Apple."),util.loaderHide()}})},this.filterPodcasts=function(a){var b="#podcast-result-template",c="#podcasts-list";util.loaderShow();var d=podcast.getPodcastsLocal("podcasts");""!=a?(a=a.toUpperCase(),d=jQuery(d.feed.entry).filter(function(b,c){var d=c.title.label.toUpperCase(),e=c["im:artist"].label.toUpperCase();return-1<d.indexOf(a)||-1<e.indexOf(a)})):d=d.feed.entry;var e=d.length;jQuery("#contador-podcasts").html(e),podcast.drawResults(d,b,c),jQuery(".podcast-container").on("click",function(){var a=jQuery(this).data("id"),b=jQuery(this).find(".podcast-title").html();jQuery.router.go("/podcast/"+a,b)})},this.getPodcastsLocal=function(a){var b=localStorage.getItem(a);return JSON.parse(b).datos},this.isPodcastsLocal=function(a){var b=!1,c=localStorage.getItem(a);if(null!=c){c=JSON.parse(c);var d=c.fecha;d==util.getStringDateNow()&&(b=!0)}return b},this.showPod=function(a,b){var c=jQuery("#title_"+a).val(),d=jQuery("#desc_"+a).val(),e=jQuery("#mp3_"+a).val();jQuery(".podtitle").html(c),jQuery(".poddesc").html(d),jQuery(".podaudio").attr("src",e),jQuery(".episodes").fadeOut(500,function(){jQuery(".podcast-detail").fadeIn(500),jQuery(".btn-volver").attr("href",'javascript:jQuery.router.go("/podcast/'+b+'", "");')})},this.removeLocalData=function(a){localStorage.removeItem(a)},this.setLocalData=function(a,b){var c=util.getStringDateNow(),d={fecha:c,datos:a};d=JSON.stringify(d),localStorage.setItem(b,d)}};